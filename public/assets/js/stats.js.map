{"version":3,"sources":["stats.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"stats.js","sourcesContent":["(function(namespace, $) {\r\n  \"use strict\";\r\n\r\n  var VpsMonthlyDatatable = function() {\r\n    // Create reference to this instance\r\n    var o = this;\r\n    // Initialize app when document is ready\r\n    $(document).ready(function() {\r\n      o.initialize();\r\n    });\r\n  };\r\n\r\n  var p = VpsMonthlyDatatable.prototype;\r\n\r\n  // =========================================================================\r\n  // INIT\r\n  // =========================================================================\r\n\r\n  p.initialize = function() {\r\n    //DataTable and Graph\r\n    this._initDataTables();\r\n    //Knob Charts\r\n    this._initKnobCharts();\r\n  };\r\n  \r\n  // =========================================================================\r\n  // CHARTS\r\n  // =========================================================================\r\n\r\n  p._initKnobCharts = function () {\r\n    var q = this;\r\n    $.ajax({\r\n      url: $('#knob-container').data('source'),\r\n      type: 'POST',\r\n      success: function(response) {\r\n        q._knob(response);\r\n        $(window).trigger('resize').trigger('scroll');\r\n        setInterval(function(){ q._refreshKnob(); }, 2000, q);\r\n      },\r\n      error: function (error) {\r\n        var dials = new Array(); \r\n        dials[0] = $('#cpu-knob'), dials[1] = $('#ram-knob');\r\n\r\n        $.each(dials, function(k, $dial) {\r\n          $dial.closest('.knob').removeClass('loading-spinner');\r\n          $dial.closest('.knob').html('<div class=\"alert alert-danger width-5\" style=\"padding: 1em;\">Something went wrong!</div>');\r\n        });\r\n      }\r\n    })\r\n  };\r\n\r\n  p._knob = function(response) {\r\n    var dials = new Array(), q =this, options; \r\n        dials[0] = $('#cpu-knob'), dials[1] = $('#ram-knob');\r\n    $.each(dials, function(k, $dial) {\r\n      options = materialadmin.App.getKnobStyle($dial);\r\n      if(k == 0){\r\n        $dial.val(response.cpu_used).trigger('change');\r\n      } else {\r\n        $dial.val(response.ram_used).trigger('change');\r\n      }\r\n      $dial.knob(options);\r\n      $dial.closest('.knob').removeClass('loading-spinner');\r\n      $dial.removeClass('hidden');\r\n    });\r\n  };\r\n\r\n  p._refreshKnob = function(response) {\r\n    $.ajax({\r\n      url: $('#knob-container').data('source'),\r\n      type: 'POST',\r\n      success: function(response) {\r\n        var dials = new Array(); \r\n        dials[0] = $('#cpu-knob'), dials[1] = $('#ram-knob');\r\n        $.each(dials, function(k, $dial) {\r\n          if(k == 0){\r\n            $dial.val(response.cpu_used).trigger('change');\r\n          } else {\r\n            $dial.val(response.ram_used).trigger('change');\r\n          }\r\n        });\r\n        $(window).trigger('resize').trigger('scroll');\r\n      }\r\n    })\r\n  }\r\n\r\n  // =========================================================================\r\n  // DATATABLES\r\n  // =========================================================================\r\n\r\n  p._initDataTables = function() {\r\n    if (!$.isFunction($.fn.dataTable)) {\r\n      return;\r\n    }\r\n\r\n    this._monthly();\r\n    this._daily();\r\n\r\n    var q = this;\r\n    $('#usage-date').on('change', function(){\r\n      $('.display-usage-date').text($('#usage-date option:selected').text());\r\n      q._monthly(true);\r\n      q._daily(true);\r\n    });\r\n  };\r\n\r\n  p._monthly = function(refresh) {\r\n    var q = this;\r\n    $.ajax({\r\n      url: $('#vps-monthly-datatable').data('source'),\r\n      type: 'POST',\r\n      data: {t_date:$('#usage-date').val()},\r\n      success: function(response) {\r\n        $('#total-upload-usage').text(response.selected_traffic.t_out + ' GB');\r\n        $('#total-download-usage').text(response.selected_traffic.t_in + ' GB');\r\n        if(refresh) {\r\n          q._refreshMonthlyDatatable(response.traffic);\r\n          q._makeGraph(response.traffic, 'monthly');\r\n        } else {\r\n          q._createMonthlyDatatable(response.traffic);\r\n          q._makeGraph(response.traffic, 'monthly');\r\n        }\r\n        $(window).trigger('resize').trigger('scroll');\r\n      }\r\n    });\r\n  };\r\n\r\n  p._daily = function(refresh) {\r\n    var q = this;\r\n    $.ajax({\r\n      url: $('#vps-daily-datatable').data('source'),\r\n      type: 'POST',\r\n      data: {t_date:$('#usage-date').val()},\r\n      success: function(response) {\r\n        if(refresh) {\r\n          q._refreshDailyDatatable(response);\r\n          q._makeGraph(response, 'daily');\r\n        } else {\r\n          q._createDailyDatatable(response);\r\n          q._makeGraph(response, 'daily');\r\n        }\r\n        $(window).trigger('resize').trigger('scroll');\r\n      }\r\n    })\r\n  };\r\n\r\n  p._makeGraph = function(response, graphName) {\r\n    var graph = $('#'+graphName+'-graph');\r\n    if (!$.isFunction($.fn.plot) || graph.length === 0) {\r\n      return;\r\n    }\r\n\r\n    var q = this, labelColor = graph.css('color');\r\n    var data = [\r\n      {\r\n        label: 'Download',\r\n        data: q._getData(graphName, response, 't_in'),\r\n        last: true\r\n      },\r\n      {\r\n        label: 'Upload',\r\n        data: q._getData(graphName, response, 't_out'),\r\n        last: true\r\n      }\r\n    ];\r\n\r\n    var options = {\r\n      colors: graph.data('color').split(','),\r\n      series: {\r\n        shadowSize: 0,\r\n        lines: {\r\n          show: true,\r\n          lineWidth: 2\r\n        },\r\n        points: {\r\n          show: true,\r\n          radius: 3,\r\n          lineWidth: 2\r\n        }\r\n      },\r\n      legend: {\r\n        show: true,\r\n        position: 'nw'\r\n      },\r\n      xaxis: {\r\n        mode: null,\r\n        tickFormatter: function(i,obj){\r\n          if(i == Math.floor(i) && graphName == 'monthly'){\r\n            return m[i]\r\n          } else if(i == Math.floor(i) && graphName == 'daily'){\r\n            return i;\r\n          } else {\r\n            return '';\r\n          }\r\n        },\r\n        color: 'rgba(0, 0, 0, 0)',\r\n        font: {color: labelColor}\r\n      },\r\n      yaxis: {\r\n        font: {color: labelColor}\r\n      },\r\n      grid: {\r\n        borderWidth: 0,\r\n        color: labelColor,\r\n        hoverable: true\r\n      }\r\n    };\r\n\r\n    graph.width('100%');\r\n    var plot = $.plot(graph, data, options);\r\n\r\n    var tip, previousPoint = null;\r\n    graph.bind(\"plothover\", function (event, pos, item) {\r\n      if (item) {\r\n        if (previousPoint !== item.dataIndex) {\r\n          previousPoint = item.dataIndex;\r\n\r\n          var x = item.datapoint[0];\r\n          var y = item.datapoint[1];\r\n          var tipLabel = '<strong>' + $(this).data('title') + '</strong>';\r\n          var tipContent = y + \" GB \" + item.series.label.toLowerCase() + \" on \" + m[x];\r\n\r\n          if (tip !== undefined) {\r\n            $(tip).popover('destroy');\r\n          }\r\n          tip = $('<div></div>').appendTo('body').css({left: item.pageX, top: item.pageY - 5, position: 'absolute'});\r\n          tip.popover({html: true, title: tipLabel, content: tipContent, placement: 'top'}).popover('show');\r\n        }\r\n      }\r\n      else {\r\n        if (tip !== undefined) {\r\n          $(tip).popover('destroy');\r\n        }\r\n        previousPoint = null;\r\n      }\r\n    });\r\n  };\r\n\r\n  p._createMonthlyDatatable = function(response) {\r\n    var table = $('#vps-monthly-datatable').DataTable({\r\n      \"dom\": 'T<\"clear\">lfrtip',\r\n      \"processing\": true,\r\n      \"paging\": false,\r\n      \"data\": response,\r\n      \"columns\": [\r\n        {\"data\": \"mno\", \"render\": function(data,row,full) {\r\n          return m[data];\r\n        }},\r\n        {\"data\": \"t_in\", \"searchable\": false},\r\n        {\"data\": \"t_out\", \"searchable\": false},\r\n        {\"data\": \"t_total\", \"searchable\": false}\r\n      ],\r\n      \"tableTools\": {\r\n        \"sSwfPath\": $('#vps-monthly-datatable').data('swftools')\r\n      },\r\n      \"order\": [],\r\n      \"language\": {\r\n        \"lengthMenu\": '_MENU_ entries per page',\r\n        \"search\": '<i class=\"fa fa-search\"></i>',\r\n        \"paginate\": {\r\n          \"previous\": '<i class=\"fa fa-angle-left\"></i>',\r\n          \"next\": '<i class=\"fa fa-angle-right\"></i>'\r\n        }\r\n      },\r\n      \"drawCallback\": function( settings ) {\r\n        $(window).trigger('resize').trigger('scroll');\r\n        $('[data-toggle=\"tooltip\"]').tooltip();\r\n      }\r\n    });\r\n  };\r\n\r\n  p._createDailyDatatable = function(response) {\r\n    var table = $('#vps-daily-datatable').DataTable({\r\n      \"dom\": 'T<\"clear\">lfrtip',\r\n      \"processing\": true,\r\n      \"data\": response,\r\n      \"columns\": [\r\n        {\"data\": \"dno\"},\r\n        {\"data\": \"t_in\", \"searchable\": false},\r\n        {\"data\": \"t_out\", \"searchable\": false},\r\n        {\"data\": \"t_total\", \"searchable\": false}\r\n      ],\r\n      \"tableTools\": {\r\n        \"sSwfPath\": $('#vps-daily-datatable').data('swftools')\r\n      },\r\n      \"order\": [],\r\n      \"language\": {\r\n        \"lengthMenu\": '_MENU_ entries per page',\r\n        \"search\": '<i class=\"fa fa-search\"></i>',\r\n        \"paginate\": {\r\n          \"previous\": '<i class=\"fa fa-angle-left\"></i>',\r\n          \"next\": '<i class=\"fa fa-angle-right\"></i>'\r\n        }\r\n      },\r\n      \"drawCallback\": function( settings ) {\r\n        $(window).trigger('resize').trigger('scroll');\r\n        $('[data-toggle=\"tooltip\"]').tooltip();\r\n      }\r\n    });\r\n  };\r\n\r\n  p._refreshMonthlyDatatable = function(response) {\r\n    var table = $('#vps-monthly-datatable').DataTable();\r\n\r\n    table.clear();\r\n    table.rows.add(response);\r\n    table.draw();\r\n  };\r\n\r\n  p._refreshDailyDatatable = function(response) {\r\n    var table = $('#vps-daily-datatable').DataTable();\r\n\r\n    table.clear();\r\n    table.rows.add(response);\r\n    table.draw();\r\n  };\r\n\r\n  p._getData = function(graphName, response, query) {\r\n    var data = [];\r\n    $.each(response, function(k,v){\r\n      if(graphName == 'monthly'){\r\n        data.push([v['mno'], v[query]]);\r\n      } else {\r\n        data.push([v['dno'], v[query]]);\r\n      }\r\n    })\r\n    return data;\r\n  };\r\n  // =========================================================================\r\n  namespace.VpsMonthlyDatatable = new VpsMonthlyDatatable;\r\n}(this.materialadmin, jQuery)); // pass in (namespace, jQuery):\r\n"],"sourceRoot":"/source/"}